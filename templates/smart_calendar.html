{% extends "base.html" %}

{% block title %}Smart Calendar Maker{% endblock %}
{% block header %}Smart Calendar Maker{% endblock %}
{% block subtitle %}AI-powered content scheduling for optimal engagement{% endblock %}

{% block content %}
<!-- Setup Section -->
<div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
    <!-- Calendar Configuration -->
    <div class="xl:col-span-2 card p-8">
        <div class="flex items-center mb-6">
            <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center mr-4">
                <i class="fas fa-calendar-alt text-emerald-400 text-xl"></i>
            </div>
            <div>
                <h3 class="text-2xl font-semibold text-white">Calendar Setup</h3>
                <p class="text-slate-400">Configure your content strategy and posting preferences</p>
            </div>
        </div>
        
        <form id="calendar-form" class="api-form space-y-6">
            <!-- Content Goals -->
            <div>
                <label for="content-goals" class="block text-lg font-medium text-white mb-3">
                    <i class="fas fa-bullseye text-emerald-400 mr-2"></i>
                    Content Goals & Topics
                </label>
                <textarea id="content-goals" rows="4" 
                         class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200" 
                         placeholder="e.g., Photography tutorials, Behind-the-scenes content, Product reviews, Tips and tricks..." required></textarea>
                <p class="text-slate-500 text-sm mt-2">
                    <i class="fas fa-info-circle mr-1"></i>
                    Describe your content themes and goals to help AI suggest relevant topics
                </p>
            </div>

            <!-- Posting Frequency -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="posting-frequency" class="block text-lg font-medium text-white mb-3">Posting Frequency</label>
                    <select id="posting-frequency" class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="daily">Daily (7 posts/week)</option>
                        <option value="frequent" selected>Frequent (4-5 posts/week)</option>
                        <option value="regular">Regular (2-3 posts/week)</option>
                        <option value="weekly">Weekly (1 post/week)</option>
                    </select>
                </div>
                <div>
                    <label for="content-duration" class="block text-lg font-medium text-white mb-3">Planning Period</label>
                    <select id="content-duration" class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="1">1 Week</option>
                        <option value="2" selected>2 Weeks</option>
                        <option value="4">1 Month</option>
                        <option value="8">2 Months</option>
                    </select>
                </div>
            </div>

            <!-- Platform Selection -->
            <div>
                <label class="block text-lg font-medium text-white mb-3">
                    <i class="fas fa-share-alt text-blue-400 mr-2"></i>
                    Target Platforms
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <label class="flex items-center p-3 rounded-lg bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-colors duration-200">
                        <input type="checkbox" name="platforms" value="youtube" checked class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-youtube text-red-400 mr-2"></i>
                        <span class="text-white text-sm">YouTube</span>
                    </label>
                    <label class="flex items-center p-3 rounded-lg bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-colors duration-200">
                        <input type="checkbox" name="platforms" value="instagram" class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-instagram text-pink-400 mr-2"></i>
                        <span class="text-white text-sm">Instagram</span>
                    </label>
                    <label class="flex items-center p-3 rounded-lg bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-colors duration-200">
                        <input type="checkbox" name="platforms" value="tiktok" class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-tiktok text-purple-400 mr-2"></i>
                        <span class="text-white text-sm">TikTok</span>
                    </label>
                    <label class="flex items-center p-3 rounded-lg bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-colors duration-200">
                        <input type="checkbox" name="platforms" value="twitter" class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-twitter text-blue-400 mr-2"></i>
                        <span class="text-white text-sm">Twitter</span>
                    </label>
                </div>
            </div>

            <!-- Timezone -->
            <div>
                <label for="timezone" class="block text-lg font-medium text-white mb-3">
                    <i class="fas fa-globe text-blue-400 mr-2"></i>
                    Timezone
                </label>
                <select id="timezone" class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
                    <option value="America/New_York">Eastern Time (EST/EDT)</option>
                    <option value="America/Chicago">Central Time (CST/CDT)</option>
                    <option value="America/Denver">Mountain Time (MST/MDT)</option>
                    <option value="America/Los_Angeles" selected>Pacific Time (PST/PDT)</option>
                    <option value="UTC">UTC</option>
                    <option value="Europe/London">London (GMT/BST)</option>
                    <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                </select>
            </div>
            
            <button type="submit" id="generate-calendar-button" 
                    class="w-full btn-primary px-8 py-4 rounded-xl text-white font-semibold text-lg hover:shadow-lg transform transition-all duration-200 flex items-center justify-center">
                <span id="calendar-button-text">Generate Smart Calendar</span>
                <i id="calendar-spinner" class="fas fa-spinner fa-spin ml-3 hidden"></i>
                <i class="fas fa-magic ml-3" id="calendar-icon"></i>
            </button>
        </form>
    </div>
    
    <!-- Quick Stats & Preview -->
    <div class="space-y-6">
        <!-- Engagement Insights -->
        <div class="card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">
                <i class="fas fa-chart-line text-emerald-400 mr-2"></i>
                Optimal Posting Times
            </h3>
            <div class="space-y-3">
                <div class="flex justify-between items-center p-3 rounded-lg bg-slate-700/30">
                    <span class="text-slate-300 text-sm">Peak Engagement</span>
                    <span class="text-emerald-400 font-semibold">6-8 PM</span>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg bg-slate-700/30">
                    <span class="text-slate-300 text-sm">Secondary Peak</span>
                    <span class="text-blue-400 font-semibold">12-2 PM</span>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg bg-slate-700/30">
                    <span class="text-slate-300 text-sm">Best Days</span>
                    <span class="text-purple-400 font-semibold">Tue, Thu, Sat</span>
                </div>
            </div>
            <p class="text-slate-400 text-xs mt-3">
                <i class="fas fa-info-circle mr-1"></i>
                Based on platform analytics and industry trends
            </p>
        </div>

        <!-- Content Ideas Pool -->
        <div class="card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">
                <i class="fas fa-lightbulb text-yellow-400 mr-2"></i>
                Content Ideas Pool
            </h3>
            <div class="space-y-2">
                <div class="p-3 rounded-lg bg-slate-700/30 border-l-4 border-yellow-400">
                    <p class="text-white text-sm font-medium">Trending Topics</p>
                    <p class="text-slate-400 text-xs">AI content creation tips</p>
                </div>
                <div class="p-3 rounded-lg bg-slate-700/30 border-l-4 border-blue-400">
                    <p class="text-white text-sm font-medium">Educational</p>
                    <p class="text-slate-400 text-xs">Behind-the-scenes process</p>
                </div>
                <div class="p-3 rounded-lg bg-slate-700/30 border-l-4 border-green-400">
                    <p class="text-white text-sm font-medium">Seasonal</p>
                    <p class="text-slate-400 text-xs">Summer productivity tips</p>
                </div>
            </div>
        </div>

        <!-- Calendar Integration -->
        <div class="card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">
                <i class="fas fa-sync text-blue-400 mr-2"></i>
                Calendar Integration
            </h3>
            <div class="space-y-3">
                <button class="w-full p-3 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-300 hover:bg-blue-500/20 transition-colors duration-200 text-left text-sm">
                    <i class="fab fa-google mr-3"></i>
                    Connect Google Calendar
                </button>
                <button class="w-full p-3 rounded-lg bg-purple-500/10 border border-purple-500/30 text-purple-300 hover:bg-purple-500/20 transition-colors duration-200 text-left text-sm">
                    <i class="fab fa-microsoft mr-3"></i>
                    Connect Outlook Calendar
                </button>
                <button class="w-full p-3 rounded-lg bg-gray-500/10 border border-gray-500/30 text-gray-300 hover:bg-gray-500/20 transition-colors duration-200 text-left text-sm">
                    <i class="fas fa-download mr-3"></i>
                    Export as ICS File
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Generated Calendar Section -->
<div id="calendar-results" class="hidden">
    <!-- Calendar Header -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h3 class="text-2xl font-bold text-white mb-2">Your Smart Content Calendar</h3>
            <p class="text-slate-400">AI-optimized posting schedule with content suggestions</p>
        </div>
        <div class="flex space-x-2">
            <button class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-400 hover:bg-emerald-500/30 transition-colors duration-200" title="Export calendar" id="export-calendar">
                <i class="fas fa-download"></i>
            </button>
            <button class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400 hover:bg-blue-500/30 transition-colors duration-200" title="Share calendar" id="share-calendar">
                <i class="fas fa-share"></i>
            </button>
            <button class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-400 hover:bg-purple-500/30 transition-colors duration-200" title="Regenerate" id="regenerate-calendar">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <!-- Calendar Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="card p-6 text-center">
            <div class="w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-calendar-check text-emerald-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="total-posts">0</h3>
            <p class="text-slate-400 text-sm">Scheduled Posts</p>
        </div>
        
        <div class="card p-6 text-center">
            <div class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-clock text-blue-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="optimal-times">0</h3>
            <p class="text-slate-400 text-sm">Optimal Time Slots</p>
        </div>
        
        <div class="card p-6 text-center">
            <div class="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-hashtag text-purple-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="content-types">0</h3>
            <p class="text-slate-400 text-sm">Content Types</p>
        </div>
        
        <div class="card p-6 text-center">
            <div class="w-12 h-12 rounded-full bg-yellow-500/20 flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-chart-line text-yellow-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="engagement-score">0%</h3>
            <p class="text-slate-400 text-sm">Predicted Engagement</p>
        </div>
    </div>

    <!-- Calendar View Tabs -->
    <div class="mb-6">
        <div class="flex space-x-1 bg-slate-800 p-1 rounded-lg w-fit">
            <button class="calendar-tab-btn active px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200" data-view="week">
                <i class="fas fa-calendar-week mr-2"></i>Week View
            </button>
            <button class="calendar-tab-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200" data-view="month">
                <i class="fas fa-calendar-alt mr-2"></i>Month View
            </button>
            <button class="calendar-tab-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200" data-view="list">
                <i class="fas fa-list mr-2"></i>List View
            </button>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div id="calendar-view" class="card p-6">
        <div id="calendar-grid" class="space-y-4">
            <!-- Calendar content will be generated here -->
        </div>
    </div>

    <!-- Content Suggestions -->
    <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- AI Recommendations -->
        <div class="card p-6">
            <h3 class="text-xl font-semibold text-white mb-4">
                <i class="fas fa-robot text-blue-400 mr-2"></i>
                AI Recommendations
            </h3>
            <div id="ai-recommendations" class="space-y-4">
                <!-- Recommendations will be populated here -->
            </div>
        </div>

        <!-- Performance Predictions -->
        <div class="card p-6">
            <h3 class="text-xl font-semibold text-white mb-4">
                <i class="fas fa-crystal-ball text-purple-400 mr-2"></i>
                Performance Predictions
            </h3>
            <div id="performance-predictions" class="space-y-4">
                <!-- Predictions will be populated here -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentCalendarData = null;
let currentView = 'week';

document.getElementById('calendar-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const contentGoals = document.getElementById('content-goals').value;
    const postingFrequency = document.getElementById('posting-frequency').value;
    const contentDuration = document.getElementById('content-duration').value;
    const timezone = document.getElementById('timezone').value;
    
    // Get selected platforms
    const platforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked'))
        .map(checkbox => checkbox.value);
    
    if (platforms.length === 0) {
        alert('Please select at least one platform.');
        return;
    }
    
    const generateButton = document.getElementById('generate-calendar-button');
    const buttonText = document.getElementById('calendar-button-text');
    const spinner = document.getElementById('calendar-spinner');
    const icon = document.getElementById('calendar-icon');
    const resultsDiv = document.getElementById('calendar-results');
    
    // Show loading state
    buttonText.textContent = 'Generating Calendar...';
    spinner.classList.remove('hidden');
    icon.classList.add('hidden');
    generateButton.disabled = true;
    
    // Hide previous results
    resultsDiv.classList.add('hidden');

    try {
        const response = await fetch('/api/generate-calendar', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                content_goals: contentGoals,
                posting_frequency: postingFrequency,
                content_duration: parseInt(contentDuration),
                platforms: platforms,
                timezone: timezone
            })
        });

        if (!response.ok) {
            throw new Error('Calendar generation failed. Please try again.');
        }

        const data = await response.json();
        currentCalendarData = data;
        
        // Display results
        resultsDiv.classList.remove('hidden');
        updateCalendarStats(data);
        renderCalendarView(data, currentView);
        populateRecommendations(data);
        
        // Scroll to results
        resultsDiv.scrollIntoView({ behavior: 'smooth' });
        
    } catch (error) {
        console.error('Error:', error);
        alert('Error: ' + error.message);
    } finally {
        // Restore button state
        buttonText.textContent = 'Generate Smart Calendar';
        spinner.classList.add('hidden');
        icon.classList.remove('hidden');
        generateButton.disabled = false;
    }
});

function updateCalendarStats(data) {
    const totalPosts = data.calendar_items ? data.calendar_items.length : 0;
    const optimalTimes = new Set(data.calendar_items?.map(item => item.time)).size || 0;
    const contentTypes = new Set(data.calendar_items?.map(item => item.content_type)).size || 0;
    const engagementScore = data.predicted_engagement || 75;
    
    document.getElementById('total-posts').textContent = totalPosts;
    document.getElementById('optimal-times').textContent = optimalTimes;
    document.getElementById('content-types').textContent = contentTypes;
    document.getElementById('engagement-score').textContent = engagementScore + '%';
    
    // Animate the numbers
    animateNumbers();
}

function animateNumbers() {
    const statElements = ['total-posts', 'optimal-times', 'content-types'];
    statElements.forEach((id, index) => {
        const element = document.getElementById(id);
        const finalValue = parseInt(element.textContent);
        
        let currentValue = 0;
        const increment = finalValue / 20;
        const timer = setInterval(() => {
            currentValue += increment;
            if (currentValue >= finalValue) {
                currentValue = finalValue;
                clearInterval(timer);
            }
            element.textContent = Math.floor(currentValue);
        }, 50);
    });
}

// Calendar view switching
document.querySelectorAll('.calendar-tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // Update active tab
        document.querySelectorAll('.calendar-tab-btn').forEach(b => {
            b.classList.remove('active', 'bg-emerald-500', 'text-white');
            b.classList.add('text-slate-400');
        });
        this.classList.add('active', 'bg-emerald-500', 'text-white');
        this.classList.remove('text-slate-400');
        
        // Switch view
        currentView = this.dataset.view;
        if (currentCalendarData) {
            renderCalendarView(currentCalendarData, currentView);
        }
    });
});

function renderCalendarView(data, view) {
    const container = document.getElementById('calendar-grid');
    
    switch (view) {
        case 'week':
            renderWeekView(container, data);
            break;
        case 'month':
            renderMonthView(container, data);
            break;
        case 'list':
            renderListView(container, data);
            break;
    }
}

function renderWeekView(container, data) {
    const items = data.calendar_items || [];
    const weekDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    
    let html = '<div class="grid grid-cols-7 gap-4">';
    
    weekDays.forEach(day => {
        const dayItems = items.filter(item => item.day === day);
        html += `
            <div class="bg-slate-700/30 rounded-lg p-4">
                <h4 class="text-white font-medium mb-3 text-center">${day}</h4>
                <div class="space-y-2">
        `;
        
        dayItems.forEach(item => {
            const platformColor = getPlatformColor(item.platform);
            html += `
                <div class="p-3 rounded-lg bg-slate-800/50 border-l-4 ${platformColor.border} cursor-pointer hover:bg-slate-800 transition-colors duration-200">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs ${platformColor.text} font-medium">${item.platform.toUpperCase()}</span>
                        <span class="text-xs text-slate-400">${item.time}</span>
                    </div>
                    <p class="text-white text-sm font-medium">${item.title}</p>
                    <p class="text-slate-400 text-xs mt-1">${item.content_type}</p>
                </div>
            `;
        });
        
        html += '</div></div>';
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function renderMonthView(container, data) {
    const items = data.calendar_items || [];
    
    // Group items by date
    const itemsByDate = items.reduce((acc, item) => {
        const date = item.date || `2024-07-${Math.floor(Math.random() * 28) + 1}`;
        if (!acc[date]) acc[date] = [];
        acc[date].push(item);
        return acc;
    }, {});
    
    let html = '<div class="grid grid-cols-7 gap-2">';
    
    // Calendar headers
    const headers = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    headers.forEach(header => {
        html += `<div class="text-center text-slate-400 font-medium p-2">${header}</div>`;
    });
    
    // Calendar days (simplified - showing current month grid)
    for (let day = 1; day <= 31; day++) {
        const dateStr = `2024-07-${day.toString().padStart(2, '0')}`;
        const dayItems = itemsByDate[dateStr] || [];
        
        html += `
            <div class="bg-slate-700/30 rounded-lg p-2 min-h-[80px]">
                <div class="text-white text-sm font-medium mb-1">${day}</div>
                <div class="space-y-1">
        `;
        
        dayItems.slice(0, 2).forEach(item => {
            const platformColor = getPlatformColor(item.platform);
            html += `
                <div class="w-full h-2 ${platformColor.bg} rounded-full" title="${item.title}"></div>
            `;
        });
        
        if (dayItems.length > 2) {
            html += `<div class="text-xs text-slate-400">+${dayItems.length - 2} more</div>`;
        }
        
        html += '</div></div>';
    }
    
    html += '</div>';
    container.innerHTML = html;
}

function renderListView(container, data) {
    const items = data.calendar_items || [];
    
    let html = '<div class="space-y-4">';
    
    items.forEach((item, index) => {
        const platformColor = getPlatformColor(item.platform);
        html += `
            <div class="flex items-center p-4 rounded-lg bg-slate-700/30 border border-slate-600/30 hover:border-slate-500/50 transition-colors duration-200">
                <div class="w-12 h-12 rounded-lg ${platformColor.bg} flex items-center justify-center mr-4">
                    <i class="${getPlatformIcon(item.platform)} text-white text-xl"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-white font-medium">${item.title}</h4>
                    <p class="text-slate-400 text-sm">${item.content_type} • ${item.platform}</p>
                </div>
                <div class="text-right">
                    <p class="text-white font-medium">${item.day}</p>
                    <p class="text-slate-400 text-sm">${item.time}</p>
                </div>
                <div class="ml-4">
                    <button class="w-8 h-8 rounded-lg bg-slate-600 hover:bg-slate-500 flex items-center justify-center transition-colors duration-200" title="Edit post">
                        <i class="fas fa-edit text-slate-300 text-sm"></i>
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function getPlatformColor(platform) {
    const colors = {
        youtube: { bg: 'bg-red-500/20', border: 'border-red-500', text: 'text-red-400' },
        instagram: { bg: 'bg-pink-500/20', border: 'border-pink-500', text: 'text-pink-400' },
        tiktok: { bg: 'bg-purple-500/20', border: 'border-purple-500', text: 'text-purple-400' },
        twitter: { bg: 'bg-blue-500/20', border: 'border-blue-500', text: 'text-blue-400' }
    };
    return colors[platform] || colors.youtube;
}

function getPlatformIcon(platform) {
    const icons = {
        youtube: 'fab fa-youtube',
        instagram: 'fab fa-instagram',
        tiktok: 'fab fa-tiktok',
        twitter: 'fab fa-twitter'
    };
    return icons[platform] || 'fab fa-youtube';
}

function populateRecommendations(data) {
    const recommendationsContainer = document.getElementById('ai-recommendations');
    const predictionsContainer = document.getElementById('performance-predictions');
    
    // AI Recommendations
    const recommendations = data.recommendations || [
        'Consider posting educational content during weekday lunch hours for higher engagement.',
        'Behind-the-scenes content performs well on weekends when audiences have more time.',
        'Add trending hashtags to Tuesday and Thursday posts for increased visibility.',
        'Schedule interactive content (polls, Q&A) during peak evening hours.'
    ];
    
    let recHtml = '';
    recommendations.forEach(rec => {
        recHtml += `
            <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
                <div class="flex items-start">
                    <i class="fas fa-lightbulb text-blue-400 mr-3 mt-1"></i>
                    <p class="text-blue-300 text-sm">${rec}</p>
                </div>
            </div>
        `;
    });
    recommendationsContainer.innerHTML = recHtml;
    
    // Performance Predictions
    const predictions = data.predictions || [
        { metric: 'Expected Reach', value: '+25%', color: 'green' },
        { metric: 'Engagement Rate', value: '4.2%', color: 'blue' },
        { metric: 'Optimal Posts', value: '12/14', color: 'purple' },
        { metric: 'Growth Potential', value: 'High', color: 'emerald' }
    ];
    
    let predHtml = '';
    predictions.forEach(pred => {
        predHtml += `
            <div class="flex justify-between items-center p-4 rounded-lg bg-slate-700/30">
                <span class="text-slate-300">${pred.metric}</span>
                <span class="text-${pred.color}-400 font-semibold">${pred.value}</span>
            </div>
        `;
    });
    predictionsContainer.innerHTML = predHtml;
}

// Export calendar functionality
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('export-calendar').addEventListener('click', function() {
        if (currentCalendarData) {
            exportCalendarData(currentCalendarData);
        }
    });
    
    document.getElementById('share-calendar').addEventListener('click', function() {
        shareCalendar();
    });
    
    document.getElementById('regenerate-calendar').addEventListener('click', function() {
        document.getElementById('calendar-form').dispatchEvent(new Event('submit'));
    });
});

function exportCalendarData(data) {
    const items = data.calendar_items || [];
    let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Alice Insight Suite//Smart Calendar//EN\n';
    
    items.forEach((item, index) => {
        const startDate = new Date();
        startDate.setDate(startDate.getDate() + index);
        const endDate = new Date(startDate.getTime() + 60 * 60 * 1000); // 1 hour duration
        
        icsContent += `BEGIN:VEVENT\n`;
        icsContent += `UID:${index}@aliceinsight.com\n`;
        icsContent += `DTSTART:${formatDateForICS(startDate)}\n`;
        icsContent += `DTEND:${formatDateForICS(endDate)}\n`;
        icsContent += `SUMMARY:${item.title}\n`;
        icsContent += `DESCRIPTION:${item.content_type} for ${item.platform}\n`;
        icsContent += `END:VEVENT\n`;
    });
    
    icsContent += 'END:VCALENDAR';
    
    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'content-calendar.ics';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    AliceInsight.ui.showNotification('Calendar exported successfully!', 'success');
}

function formatDateForICS(date) {
    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
}

function shareCalendar() {
    if (navigator.share) {
        navigator.share({
            title: 'My Smart Content Calendar',
            text: 'Check out my AI-generated content calendar!',
            url: window.location.href
        });
    } else {
        // Fallback - copy link to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            AliceInsight.ui.showNotification('Calendar link copied to clipboard!', 'success');
        });
    }
}
</script>
{% endblock %}