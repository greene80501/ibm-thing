{% extends "base.html" %}

{% block title %}Smart Calendar Maker{% endblock %}
{% block header %}Smart Calendar Maker{% endblock %}
{% block subtitle %}AI-powered content scheduling for optimal engagement{% endblock %}

{% block content %}
<style>
.calendar-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.platform-youtube {
    background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
}

.platform-instagram {
    background: linear-gradient(135deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
}

.platform-tiktok {
    background: linear-gradient(135deg, #ff0050 0%, #00f2ea 100%);
}

.platform-twitter {
    background: linear-gradient(135deg, #1da1f2 0%, #0d8bd9 100%);
}

.calendar-item {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateY(0);
}

.calendar-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1rem;
}

.calendar-day {
    min-height: 120px;
    position: relative;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.calendar-day:hover {
    transform: scale(1.02);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.calendar-day.has-posts {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
    border: 1px solid rgba(59, 130, 246, 0.3);
}

.calendar-day.today {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.15) 100%);
    border: 2px solid rgba(16, 185, 129, 0.5);
}

.post-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    margin: 1px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.floating-animation {
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.slide-in-up {
    animation: slideInUp 0.6s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.glow-effect {
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
}

.calendar-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
    padding: 1rem;
    border-radius: 12px 12px 0 0;
    font-weight: bold;
    font-size: 1.1rem;
}

.week-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1rem;
    margin-bottom: 1rem;
}

.week-header-item {
    text-align: center;
    font-weight: 600;
    color: #e2e8f0;
    padding: 0.75rem;
    background: rgba(30, 41, 59, 0.5);
    border-radius: 8px;
    border: 1px solid rgba(71, 85, 105, 0.3);
}

.calendar-post {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 6px;
    padding: 0.5rem;
    margin: 0.25rem 0;
    border-left: 3px solid;
    font-size: 0.75rem;
    transition: all 0.2s ease;
}

.calendar-post:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
}

.engagement-meter {
    height: 4px;
    background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
    border-radius: 2px;
    margin-top: 0.5rem;
}

.engagement-fill {
    height: 100%;
    background: white;
    border-radius: 2px;
    transition: width 1s ease-in-out;
}
</style>

<!-- Setup Section -->
<div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
    <!-- Calendar Configuration -->
    <div class="xl:col-span-2 card p-8 relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 opacity-10">
            <div class="absolute top-10 left-10 w-20 h-20 bg-emerald-400 rounded-full floating-animation"></div>
            <div class="absolute top-32 right-20 w-16 h-16 bg-blue-400 rounded-full floating-animation" style="animation-delay: 2s;"></div>
            <div class="absolute bottom-20 left-32 w-12 h-12 bg-purple-400 rounded-full floating-animation" style="animation-delay: 4s;"></div>
        </div>
        
        <div class="flex items-center mb-6 relative z-10">
            <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center mr-4 glow-effect">
                <i class="fas fa-calendar-alt text-emerald-400 text-xl"></i>
            </div>
            <div>
                <h3 class="text-2xl font-semibold text-white mb-1">Calendar Setup</h3>
                <p class="text-slate-400">Configure your content strategy and posting preferences</p>
            </div>
        </div>
        
        <form id="calendar-form" class="api-form space-y-6 relative z-10">
            <!-- Content Goals -->
            <div class="slide-in-up">
                <label for="content-goals" class="block text-lg font-medium text-white mb-3">
                    <i class="fas fa-bullseye text-emerald-400 mr-2"></i>
                    Content Goals & Topics
                </label>
                <textarea id="content-goals" rows="4" 
                         class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 backdrop-blur-sm" 
                         placeholder="e.g., Photography tutorials, Behind-the-scenes content, Product reviews, Tips and tricks..." required></textarea>
                <p class="text-slate-500 text-sm mt-2">
                    <i class="fas fa-info-circle mr-1"></i>
                    Describe your content themes and goals to help AI suggest relevant topics
                </p>
            </div>

            <!-- Posting Frequency -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 slide-in-up" style="animation-delay: 0.1s;">
                <div>
                    <label for="posting-frequency" class="block text-lg font-medium text-white mb-3">Posting Frequency</label>
                    <select id="posting-frequency" class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 backdrop-blur-sm">
                        <option value="daily">Daily (7 posts/week)</option>
                        <option value="frequent" selected>Frequent (4-5 posts/week)</option>
                        <option value="regular">Regular (2-3 posts/week)</option>
                        <option value="weekly">Weekly (1 post/week)</option>
                    </select>
                </div>
                <div>
                    <label for="content-duration" class="block text-lg font-medium text-white mb-3">Planning Period</label>
                    <select id="content-duration" class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 backdrop-blur-sm">
                        <option value="1">1 Week</option>
                        <option value="2" selected>2 Weeks</option>
                        <option value="4">1 Month</option>
                        <option value="8">2 Months</option>
                    </select>
                </div>
            </div>

            <!-- Platform Selection -->
            <div class="slide-in-up" style="animation-delay: 0.2s;">
                <label class="block text-lg font-medium text-white mb-3">
                    <i class="fas fa-share-alt text-blue-400 mr-2"></i>
                    Target Platforms
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <label class="platform-selector flex items-center p-4 rounded-xl bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-all duration-300 hover:scale-105">
                        <input type="checkbox" name="platforms" value="youtube" checked class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-youtube text-red-400 mr-2 text-lg"></i>
                        <span class="text-white text-sm font-medium">YouTube</span>
                    </label>
                    <label class="platform-selector flex items-center p-4 rounded-xl bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-all duration-300 hover:scale-105">
                        <input type="checkbox" name="platforms" value="instagram" class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-instagram text-pink-400 mr-2 text-lg"></i>
                        <span class="text-white text-sm font-medium">Instagram</span>
                    </label>
                    <label class="platform-selector flex items-center p-4 rounded-xl bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-all duration-300 hover:scale-105">
                        <input type="checkbox" name="platforms" value="tiktok" class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-tiktok text-purple-400 mr-2 text-lg"></i>
                        <span class="text-white text-sm font-medium">TikTok</span>
                    </label>
                    <label class="platform-selector flex items-center p-4 rounded-xl bg-slate-700/30 border border-slate-600/30 cursor-pointer hover:bg-slate-700/50 transition-all duration-300 hover:scale-105">
                        <input type="checkbox" name="platforms" value="twitter" class="mr-3 rounded text-emerald-500 focus:ring-emerald-500">
                        <i class="fab fa-twitter text-blue-400 mr-2 text-lg"></i>
                        <span class="text-white text-sm font-medium">Twitter</span>
                    </label>
                </div>
            </div>

            <!-- Timezone -->
            <div class="slide-in-up" style="animation-delay: 0.3s;">
                <label for="timezone" class="block text-lg font-medium text-white mb-3">
                    <i class="fas fa-globe text-blue-400 mr-2"></i>
                    Timezone
                </label>
                <select id="timezone" class="w-full p-4 bg-slate-800/50 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 backdrop-blur-sm">
                    <option value="America/New_York">Eastern Time (EST/EDT)</option>
                    <option value="America/Chicago">Central Time (CST/CDT)</option>
                    <option value="America/Denver">Mountain Time (MST/MDT)</option>
                    <option value="America/Los_Angeles" selected>Pacific Time (PST/PDT)</option>
                    <option value="UTC">UTC</option>
                    <option value="Europe/London">London (GMT/BST)</option>
                    <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                </select>
            </div>
            
            <button type="submit" id="generate-calendar-button" 
                    class="w-full btn-primary px-8 py-4 rounded-xl text-white font-semibold text-lg hover:shadow-lg transform transition-all duration-300 hover:scale-105 flex items-center justify-center calendar-gradient slide-in-up" style="animation-delay: 0.4s;">
                <span id="calendar-button-text">Generate Smart Calendar</span>
                <i id="calendar-spinner" class="fas fa-spinner fa-spin ml-3 hidden"></i>
                <i class="fas fa-magic ml-3" id="calendar-icon"></i>
            </button>
        </form>
    </div>
    
    <!-- Quick Stats & Preview -->
    <div class="space-y-6">
        <!-- Engagement Insights -->
        <div class="card p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <h3 class="text-lg font-semibold text-white mb-4">
                <i class="fas fa-chart-line text-emerald-400 mr-2"></i>
                Optimal Posting Times
            </h3>
            <div class="space-y-3">
                <div class="flex justify-between items-center p-3 rounded-lg bg-slate-700/30 hover:bg-slate-700/50 transition-colors duration-200">
                    <span class="text-slate-300 text-sm">Peak Engagement</span>
                    <span class="text-emerald-400 font-semibold">6-8 PM</span>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg bg-slate-700/30 hover:bg-slate-700/50 transition-colors duration-200">
                    <span class="text-slate-300 text-sm">Secondary Peak</span>
                    <span class="text-blue-400 font-semibold">12-2 PM</span>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg bg-slate-700/30 hover:bg-slate-700/50 transition-colors duration-200">
                    <span class="text-slate-300 text-sm">Best Days</span>
                    <span class="text-purple-400 font-semibold">Tue, Thu, Sat</span>
                </div>
            </div>
            <p class="text-slate-400 text-xs mt-3">
                <i class="fas fa-info-circle mr-1"></i>
                Based on platform analytics and industry trends
            </p>
        </div>

        <!-- Content Ideas Pool -->
        <div class="card p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <h3 class="text-lg font-semibold text-white mb-4">
                <i class="fas fa-lightbulb text-yellow-400 mr-2"></i>
                Content Ideas Pool
            </h3>
            <div class="space-y-2">
                <div class="p-3 rounded-lg bg-slate-700/30 border-l-4 border-yellow-400 hover:bg-slate-700/50 transition-colors duration-200 cursor-pointer">
                    <p class="text-white text-sm font-medium">Trending Topics</p>
                    <p class="text-slate-400 text-xs">AI content creation tips</p>
                </div>
                <div class="p-3 rounded-lg bg-slate-700/30 border-l-4 border-blue-400 hover:bg-slate-700/50 transition-colors duration-200 cursor-pointer">
                    <p class="text-white text-sm font-medium">Educational</p>
                    <p class="text-slate-400 text-xs">Behind-the-scenes process</p>
                </div>
                <div class="p-3 rounded-lg bg-slate-700/30 border-l-4 border-green-400 hover:bg-slate-700/50 transition-colors duration-200 cursor-pointer">
                    <p class="text-white text-sm font-medium">Seasonal</p>
                    <p class="text-slate-400 text-xs">Summer productivity tips</p>
                </div>
            </div>
        </div>

        <!-- Calendar Integration -->
        <div class="card p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <h3 class="text-lg font-semibold text-white mb-4">
                <i class="fas fa-sync text-blue-400 mr-2"></i>
                Calendar Integration
            </h3>
            <div class="space-y-3">
                <button class="w-full p-3 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-300 hover:bg-blue-500/20 transition-all duration-300 hover:scale-105 text-left text-sm">
                    <i class="fab fa-google mr-3"></i>
                    Connect Google Calendar
                </button>
                <button class="w-full p-3 rounded-lg bg-purple-500/10 border border-purple-500/30 text-purple-300 hover:bg-purple-500/20 transition-all duration-300 hover:scale-105 text-left text-sm">
                    <i class="fab fa-microsoft mr-3"></i>
                    Connect Outlook Calendar
                </button>
                <button class="w-full p-3 rounded-lg bg-gray-500/10 border border-gray-500/30 text-gray-300 hover:bg-gray-500/20 transition-all duration-300 hover:scale-105 text-left text-sm">
                    <i class="fas fa-download mr-3"></i>
                    Export as ICS File
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Generated Calendar Section -->
<div id="calendar-results" class="hidden">
    <!-- Calendar Header -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h3 class="text-2xl font-bold text-white mb-2">Your Smart Content Calendar</h3>
            <p class="text-slate-400">AI-optimized posting schedule with content suggestions</p>
        </div>
        <div class="flex space-x-2">
            <button class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-400 hover:bg-emerald-500/30 transition-all duration-300 hover:scale-110" title="Export calendar" id="export-calendar">
                <i class="fas fa-download"></i>
            </button>
            <button class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400 hover:bg-blue-500/30 transition-all duration-300 hover:scale-110" title="Share calendar" id="share-calendar">
                <i class="fas fa-share"></i>
            </button>
            <button class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-400 hover:bg-purple-500/30 transition-all duration-300 hover:scale-110" title="Regenerate" id="regenerate-calendar">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <!-- Calendar Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="card p-6 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-3 glow-effect">
                <i class="fas fa-calendar-check text-emerald-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="total-posts">0</h3>
            <p class="text-slate-400 text-sm">Scheduled Posts</p>
            <div class="engagement-meter mt-2">
                <div class="engagement-fill" id="posts-fill" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="card p-6 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center mx-auto mb-3 glow-effect">
                <i class="fas fa-clock text-blue-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="optimal-times">0</h3>
            <p class="text-slate-400 text-sm">Optimal Time Slots</p>
            <div class="engagement-meter mt-2">
                <div class="engagement-fill" id="times-fill" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="card p-6 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-3 glow-effect">
                <i class="fas fa-hashtag text-purple-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="content-types">0</h3>
            <p class="text-slate-400 text-sm">Content Types</p>
            <div class="engagement-meter mt-2">
                <div class="engagement-fill" id="types-fill" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="card p-6 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
            <div class="w-12 h-12 rounded-full bg-yellow-500/20 flex items-center justify-center mx-auto mb-3 glow-effect">
                <i class="fas fa-chart-line text-yellow-400 text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-1" id="engagement-score">0%</h3>
            <p class="text-slate-400 text-sm">Predicted Engagement</p>
            <div class="engagement-meter mt-2">
                <div class="engagement-fill" id="engagement-fill" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Calendar View Tabs -->
    <div class="mb-6">
        <div class="flex space-x-1 bg-slate-800 p-1 rounded-lg w-fit">
            <button class="calendar-tab-btn active px-6 py-3 rounded-md text-sm font-medium transition-all duration-300 hover:scale-105" data-view="month">
                <i class="fas fa-calendar-alt mr-2"></i>Month View
            </button>
            <button class="calendar-tab-btn px-6 py-3 rounded-md text-sm font-medium transition-all duration-300 hover:scale-105" data-view="week">
                <i class="fas fa-calendar-week mr-2"></i>Week View
            </button>
            <button class="calendar-tab-btn px-6 py-3 rounded-md text-sm font-medium transition-all duration-300 hover:scale-105" data-view="list">
                <i class="fas fa-list mr-2"></i>List View
            </button>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div id="calendar-view" class="card overflow-hidden">
        <div class="calendar-header">
            <h4 id="calendar-month-year">July 2024</h4>
        </div>
        <div class="p-6">
            <div id="calendar-grid" class="space-y-4">
                <!-- Calendar content will be generated here -->
            </div>
        </div>
    </div>

    <!-- Content Suggestions -->
    <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- AI Recommendations -->
        <div class="card p-6 hover:shadow-xl transition-all duration-300">
            <h3 class="text-xl font-semibold text-white mb-4">
                <i class="fas fa-robot text-blue-400 mr-2"></i>
                AI Recommendations
            </h3>
            <div id="ai-recommendations" class="space-y-4">
                <!-- Recommendations will be populated here -->
            </div>
        </div>

        <!-- Performance Predictions -->
        <div class="card p-6 hover:shadow-xl transition-all duration-300">
            <h3 class="text-xl font-semibold text-white mb-4">
                <i class="fas fa-crystal-ball text-purple-400 mr-2"></i>
                Performance Predictions
            </h3>
            <div id="performance-predictions" class="space-y-4">
                <!-- Predictions will be populated here -->
            </div>
        </div>
    </div>
</div>

<script>
let currentCalendarData = null;
let currentView = 'month';

document.getElementById('calendar-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const contentGoals = document.getElementById('content-goals').value;
    const postingFrequency = document.getElementById('posting-frequency').value;
    const contentDuration = document.getElementById('content-duration').value;
    const timezone = document.getElementById('timezone').value;
    
    // Get selected platforms
    const platforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked'))
        .map(checkbox => checkbox.value);
    
    if (platforms.length === 0) {
        showNotification('Please select at least one platform.', 'error');
        return;
    }
    
    const generateButton = document.getElementById('generate-calendar-button');
    const buttonText = document.getElementById('calendar-button-text');
    const spinner = document.getElementById('calendar-spinner');
    const icon = document.getElementById('calendar-icon');
    const resultsDiv = document.getElementById('calendar-results');
    
    // Show loading state with enhanced animation
    buttonText.textContent = 'Generating Calendar...';
    spinner.classList.remove('hidden');
    icon.classList.add('hidden');
    generateButton.disabled = true;
    generateButton.classList.add('opacity-75');
    
    // Hide previous results with animation
    if (!resultsDiv.classList.contains('hidden')) {
        resultsDiv.style.opacity = '0';
        resultsDiv.style.transform = 'translateY(20px)';
        setTimeout(() => resultsDiv.classList.add('hidden'), 300);
    }

    try {
        const response = await fetch('/api/generate-calendar', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                content_goals: contentGoals,
                posting_frequency: postingFrequency,
                content_duration: parseInt(contentDuration),
                platforms: platforms,
                timezone: timezone
            })
        });

        if (!response.ok) {
            throw new Error('Calendar generation failed. Please try again.');
        }

        const data = await response.json();
        currentCalendarData = data;
        
        // Show results with enhanced animation
        setTimeout(() => {
            resultsDiv.classList.remove('hidden');
            resultsDiv.style.opacity = '0';
            resultsDiv.style.transform = 'translateY(20px)';
            
            requestAnimationFrame(() => {
                resultsDiv.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                resultsDiv.style.opacity = '1';
                resultsDiv.style.transform = 'translateY(0)';
            });
            
            updateCalendarStats(data);
            renderCalendarView(data, currentView);
            populateRecommendations(data);
            
            // Scroll to results with smooth animation
            setTimeout(() => {
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }, 400);
        
    } catch (error) {
        console.error('Error:', error);
        showNotification('Error: ' + error.message, 'error');
    } finally {
        // Restore button state
        setTimeout(() => {
            buttonText.textContent = 'Generate Smart Calendar';
            spinner.classList.add('hidden');
            icon.classList.remove('hidden');
            generateButton.disabled = false;
            generateButton.classList.remove('opacity-75');
        }, 1000);
    }
});

function updateCalendarStats(data) {
    const totalPosts = data.calendar_items ? data.calendar_items.length : 0;
    const optimalTimes = new Set(data.calendar_items?.map(item => item.time)).size || 0;
    const contentTypes = new Set(data.calendar_items?.map(item => item.content_type)).size || 0;
    const engagementScore = data.predicted_engagement || 75;
    
    // Animate numbers with enhanced effects
    animateNumber('total-posts', totalPosts, 'posts-fill', (totalPosts / 20) * 100);
    animateNumber('optimal-times', optimalTimes, 'times-fill', (optimalTimes / 10) * 100);
    animateNumber('content-types', contentTypes, 'types-fill', (contentTypes / 15) * 100);
    animateNumber('engagement-score', engagementScore, 'engagement-fill', engagementScore, '%');
}

function animateNumber(elementId, finalValue, fillId, fillPercent, suffix = '') {
    const element = document.getElementById(elementId);
    const fillElement = document.getElementById(fillId);
    const duration = 2000;
    const start = performance.now();
    
    function update(currentTime) {
        const elapsed = currentTime - start;
        const progress = Math.min(elapsed / duration, 1);
        
        // Use easing function for smooth animation
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        
        const currentValue = Math.floor(finalValue * easeProgress);
        element.textContent = currentValue + suffix;
        
        // Animate fill bar
        if (fillElement) {
            fillElement.style.width = (fillPercent * easeProgress) + '%';
        }
        
        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }
    
    requestAnimationFrame(update);
}

// Enhanced calendar view switching
document.querySelectorAll('.calendar-tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // Update active tab with enhanced animation
        document.querySelectorAll('.calendar-tab-btn').forEach(b => {
            b.classList.remove('active', 'bg-emerald-500', 'text-white', 'glow-effect');
            b.classList.add('text-slate-400');
        });
        this.classList.add('active', 'bg-emerald-500', 'text-white', 'glow-effect');
        this.classList.remove('text-slate-400');
        
        // Switch view with animation
        currentView = this.dataset.view;
        if (currentCalendarData) {
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.style.opacity = '0';
            calendarGrid.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                renderCalendarView(currentCalendarData, currentView);
                calendarGrid.style.transition = 'all 0.4s ease';
                calendarGrid.style.opacity = '1';
                calendarGrid.style.transform = 'translateY(0)';
            }, 200);
        }
    });
});

function renderCalendarView(data, view) {
    const container = document.getElementById('calendar-grid');
    
    switch (view) {
        case 'month':
            renderMonthView(container, data);
            break;
        case 'week':
            renderWeekView(container, data);
            break;
        case 'list':
            renderListView(container, data);
            break;
    }
}

function renderMonthView(container, data) {
    const items = data.calendar_items || [];
    const today = new Date();
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();
    
    // Update header
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
    document.getElementById('calendar-month-year').textContent = `${monthNames[currentMonth]} ${currentYear}`;
    
    // Group items by date
    const itemsByDate = items.reduce((acc, item) => {
        const date = item.date || `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${Math.floor(Math.random() * 28) + 1}`;
        if (!acc[date]) acc[date] = [];
        acc[date].push(item);
        return acc;
    }, {});
    
    let html = '<div class="week-header">';
    const headers = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    headers.forEach(header => {
        html += `<div class="week-header-item">${header}</div>`;
    });
    html += '</div>';
    
    html += '<div class="calendar-grid">';
    
    // Get first day of month and days in month
    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Convert to Monday = 0
    
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDayOfWeek; i++) {
        html += '<div class="calendar-day"></div>';
    }
    
    // Add days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const dayItems = itemsByDate[dateStr] || [];
        const isToday = day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear();
        
        let dayClass = 'calendar-day';
        if (dayItems.length > 0) dayClass += ' has-posts';
        if (isToday) dayClass += ' today';
        
        html += `<div class="${dayClass}">`;
        html += `<div class="text-white font-semibold mb-2 text-center">${day}</div>`;
        
        // Add post indicators
        if (dayItems.length > 0) {
            html += '<div class="space-y-1">';
            dayItems.slice(0, 3).forEach(item => {
                const platformColor = getPlatformColor(item.platform);
                html += `
                    <div class="calendar-post" style="border-left-color: ${platformColor.hex}">
                        <div class="flex items-center justify-between">
                            <span class="font-medium truncate">${item.title.length > 15 ? item.title.substring(0, 15) + '...' : item.title}</span>
                            <span class="text-xs">${item.time}</span>
                        </div>
                        <div class="flex items-center mt-1">
                            <i class="${getPlatformIcon(item.platform)} mr-1"></i>
                            <span class="text-xs">${item.platform}</span>
                        </div>
                    </div>
                `;
            });
            
            if (dayItems.length > 3) {
                html += `<div class="text-xs text-slate-400 text-center">+${dayItems.length - 3} more</div>`;
            }
            html += '</div>';
            
            // Add post indicators
            html += '<div class="flex flex-wrap justify-center mt-2">';
            dayItems.forEach(item => {
                const platformColor = getPlatformColor(item.platform);
                html += `<div class="post-indicator" style="background-color: ${platformColor.hex}" title="${item.title}"></div>`;
            });
            html += '</div>';
        }
        
        html += '</div>';
    }
    
    html += '</div>';
    container.innerHTML = html;
    
    // Add click listeners for calendar days
    document.querySelectorAll('.calendar-day.has-posts').forEach(day => {
        day.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
            }, 100);
        });
    });
}

function renderWeekView(container, data) {
    const items = data.calendar_items || [];
    const weekDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    
    let html = '<div class="grid grid-cols-7 gap-4">';
    
    weekDays.forEach(day => {
        const dayItems = items.filter(item => item.day === day);
        html += `
            <div class="bg-slate-700/30 rounded-xl p-4 hover:bg-slate-700/50 transition-all duration-300">
                <h4 class="text-white font-semibold mb-3 text-center">${day}</h4>
                <div class="space-y-2">
        `;
        
        dayItems.forEach(item => {
            const platformColor = getPlatformColor(item.platform);
            html += `
                <div class="calendar-item p-3 rounded-lg bg-slate-800/50 border-l-4 cursor-pointer" style="border-left-color: ${platformColor.hex}">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs font-medium" style="color: ${platformColor.hex}">${item.platform.toUpperCase()}</span>
                        <span class="text-xs text-slate-400">${item.time}</span>
                    </div>
                    <p class="text-white text-sm font-medium leading-tight">${item.title}</p>
                    <p class="text-slate-400 text-xs mt-1">${item.content_type}</p>
                    <div class="engagement-meter mt-2">
                        <div class="engagement-fill" style="width: ${item.engagement_score}%"></div>
                    </div>
                </div>
            `;
        });
        
        html += '</div></div>';
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function renderListView(container, data) {
    const items = data.calendar_items || [];
    
    let html = '<div class="space-y-4">';
    
    items.forEach((item, index) => {
        const platformColor = getPlatformColor(item.platform);
        html += `
            <div class="calendar-item flex items-center p-6 rounded-xl bg-slate-700/30 border border-slate-600/30 hover:border-slate-500/50 transition-all duration-300">
                <div class="w-16 h-16 rounded-xl flex items-center justify-center mr-6" style="background: ${platformColor.gradient}">
                    <i class="${getPlatformIcon(item.platform)} text-white text-2xl"></i>
                </div>
                <div class="flex-1">
                    <h4 class="text-white font-semibold text-lg">${item.title}</h4>
                    <p class="text-slate-400 text-sm mt-1">${item.content_type} • ${item.platform}</p>
                    <div class="flex items-center mt-2">
                        <span class="text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-300 mr-2">${item.day}</span>
                        <span class="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300">${item.time}</span>
                    </div>
                </div>
                <div class="text-right mr-4">
                    <div class="text-white font-semibold">Engagement</div>
                    <div class="text-2xl font-bold" style="color: ${platformColor.hex}">${item.engagement_score}%</div>
                </div>
                <div class="flex flex-col space-y-2">
                    <button class="w-10 h-10 rounded-lg bg-slate-600 hover:bg-slate-500 flex items-center justify-center transition-all duration-300 hover:scale-110" title="Edit post">
                        <i class="fas fa-edit text-slate-300 text-sm"></i>
                    </button>
                    <button class="w-10 h-10 rounded-lg bg-slate-600 hover:bg-slate-500 flex items-center justify-center transition-all duration-300 hover:scale-110" title="Preview">
                        <i class="fas fa-eye text-slate-300 text-sm"></i>
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function getPlatformColor(platform) {
    const colors = {
        youtube: { 
            hex: '#ff0000', 
            gradient: 'linear-gradient(135deg, #ff0000 0%, #cc0000 100%)'
        },
        instagram: { 
            hex: '#E4405F', 
            gradient: 'linear-gradient(135deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%)'
        },
        tiktok: { 
            hex: '#ff0050', 
            gradient: 'linear-gradient(135deg, #ff0050 0%, #00f2ea 100%)'
        },
        twitter: { 
            hex: '#1da1f2', 
            gradient: 'linear-gradient(135deg, #1da1f2 0%, #0d8bd9 100%)'
        }
    };
    return colors[platform] || colors.youtube;
}

function getPlatformIcon(platform) {
    const icons = {
        youtube: 'fab fa-youtube',
        instagram: 'fab fa-instagram',
        tiktok: 'fab fa-tiktok',
        twitter: 'fab fa-twitter'
    };
    return icons[platform] || 'fab fa-youtube';
}

function populateRecommendations(data) {
    const recommendationsContainer = document.getElementById('ai-recommendations');
    const predictionsContainer = document.getElementById('performance-predictions');
    
    // Enhanced AI Recommendations
    const recommendations = data.recommendations || [
        'Peak engagement times detected: Schedule your most important content during 6-8 PM for maximum visibility.',
        'Cross-platform strategy: Your content performs well across multiple platforms - consider adapting formats.',
        'Content variety: Mix educational and entertainment content for better audience retention rates.',
        'Trending opportunities: Current topics in your niche show high engagement potential this week.'
    ];
    
    let recHtml = '';
    recommendations.forEach((rec, index) => {
        const icons = ['fas fa-clock', 'fas fa-share-alt', 'fas fa-chart-pie', 'fas fa-trending-up'];
        const colors = ['blue', 'purple', 'emerald', 'yellow'];
        const color = colors[index % colors.length];
        const icon = icons[index % icons.length];
        
        recHtml += `
            <div class="p-4 rounded-xl bg-${color}-500/10 border border-${color}-500/30 hover:bg-${color}-500/20 transition-all duration-300 hover:scale-105">
                <div class="flex items-start">
                    <i class="${icon} text-${color}-400 mr-3 mt-1"></i>
                    <p class="text-${color}-300 text-sm leading-relaxed">${rec}</p>
                </div>
            </div>
        `;
    });
    recommendationsContainer.innerHTML = recHtml;
    
    // Enhanced Performance Predictions
    const predictions = data.predictions || [
        { metric: 'Expected Reach', value: '+25%', color: 'emerald', icon: 'fas fa-users' },
        { metric: 'Engagement Rate', value: '4.2%', color: 'blue', icon: 'fas fa-heart' },
        { metric: 'Optimal Posts', value: '12/14', color: 'purple', icon: 'fas fa-target' },
        { metric: 'Growth Potential', value: 'High', color: 'yellow', icon: 'fas fa-rocket' }
    ];
    
    let predHtml = '';
    predictions.forEach(pred => {
        predHtml += `
            <div class="flex justify-between items-center p-4 rounded-xl bg-slate-700/30 hover:bg-slate-700/50 transition-all duration-300 hover:scale-105">
                <div class="flex items-center">
                    <i class="${pred.icon} text-${pred.color}-400 mr-3"></i>
                    <span class="text-slate-300">${pred.metric}</span>
                </div>
                <span class="text-${pred.color}-400 font-bold text-lg">${pred.value}</span>
            </div>
        `;
    });
    predictionsContainer.innerHTML = predHtml;
}

// Enhanced export functionality
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('export-calendar').addEventListener('click', function() {
        if (currentCalendarData) {
            this.style.transform = 'scale(0.9)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
                exportCalendarData(currentCalendarData);
            }, 150);
        }
    });
    
    document.getElementById('share-calendar').addEventListener('click', function() {
        this.style.transform = 'scale(0.9)';
        setTimeout(() => {
            this.style.transform = 'scale(1)';
            shareCalendar();
        }, 150);
    });
    
    document.getElementById('regenerate-calendar').addEventListener('click', function() {
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        setTimeout(() => {
            this.innerHTML = '<i class="fas fa-sync-alt"></i>';
            document.getElementById('calendar-form').dispatchEvent(new Event('submit'));
        }, 500);
    });
});

function exportCalendarData(data) {
    const items = data.calendar_items || [];
    let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Alice Insight Suite//Smart Calendar//EN\n';
    
    items.forEach((item, index) => {
        const startDate = new Date();
        startDate.setDate(startDate.getDate() + index);
        const endDate = new Date(startDate.getTime() + 60 * 60 * 1000);
        
        icsContent += `BEGIN:VEVENT\n`;
        icsContent += `UID:${index}@aliceinsight.com\n`;
        icsContent += `DTSTART:${formatDateForICS(startDate)}\n`;
        icsContent += `DTEND:${formatDateForICS(endDate)}\n`;
        icsContent += `SUMMARY:${item.title}\n`;
        icsContent += `DESCRIPTION:${item.content_type} for ${item.platform}\n`;
        icsContent += `END:VEVENT\n`;
    });
    
    icsContent += 'END:VCALENDAR';
    
    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'smart-content-calendar.ics';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    showNotification('Calendar exported successfully!', 'success');
}

function formatDateForICS(date) {
    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
}

function shareCalendar() {
    if (navigator.share) {
        navigator.share({
            title: 'My Smart Content Calendar',
            text: 'Check out my AI-generated content calendar from Alice Insight Suite!',
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(window.location.href).then(() => {
            showNotification('Calendar link copied to clipboard!', 'success');
        });
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
    
    const colors = {
        success: 'bg-emerald-500 text-white',
        error: 'bg-red-500 text-white',
        info: 'bg-blue-500 text-white'
    };
    
    notification.className += ` ${colors[type]}`;
    notification.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Animate out and remove
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Add platform selector animations
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.platform-selector').forEach(selector => {
        selector.addEventListener('change', function() {
            if (this.querySelector('input').checked) {
                this.classList.add('glow-effect');
            } else {
                this.classList.remove('glow-effect');
            }
        });
    });
});
</script>
{% endblock %}